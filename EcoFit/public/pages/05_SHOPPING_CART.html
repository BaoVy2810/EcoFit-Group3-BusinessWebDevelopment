<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopping Cart</title>
  <link rel="icon" href="../images/ecofit_logo2.png" sizes="32x32" type="image/png">

  <link rel="stylesheet" href="../css/USER_MAINSTYLE.css"/>
  <script src="../js/notification_handler.js"></script>
</head>
<body>
    <iframe id="header-frame" class="header-frame"></iframe>

    <!-- Shopping Cart Section -->
    <section class="cart-section">
        <div class="cart-container">
            <!-- Left Side - Cart Items -->
            <div class="cart-left">
                <h2 class="cart-title">SHOPPING CART</h2>
                <div class="cart-table">
                    <div class="cart-table__header">
                        <div class="col-item">Item</div>
                        <div class="col-quantity">Quantity</div>
                        <div class="col-subtotal">Subtotal</div>
                    </div>
                    
                    <div id="cart-items-container"></div>
                </div>
            </div>

            <!-- Right Side - Order Summary -->
            <div class="checkout-right">
                <div class="order-summary">
                    <h2 class="order-summary__title">ORDER SUMMARY</h2>
                    <div class="order-summary__row">
                        <span>Subtotal Product</span>
                        <span class="order-summary__value" id="subtotal-amount">0</span>
                    </div>
                    <div class="order-summary__row">
                        <span>Shipping Cost</span>
                        <span class="order-summary__value"  id="shipping-cost">30.000</span>
                    </div>
                    <div class="order-summary__total">
                        <span>Total</span>
                        <span class="total-value" id="total-amount">0</span>
                    </div>
                    <button class="checkout-btn">
                    <a href="06_CHECKOUT.html" target="_self">CHECKOUT â†’</a>
                </button>
                </div>
            </div>
        </div>
    </section>

    <iframe id="footer-frame" class="footer-frame"></iframe>

<script src="../../js/cart.js"></script>
<script>
    // ========== HEADER & FOOTER LOADING ==========
    window.addEventListener("DOMContentLoaded", () => {
        // Load header based on login status
        const header = document.getElementById("header-frame");
        const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
        header.src = isLoggedIn 
            ? "../template/header.html" 
            : "../template/header0.html";

        header.onload = () => {
            header.contentWindow.postMessage({ activeNav: "nav-shop" }, "*");
        };
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            header.contentWindow.postMessage({ 
                action: 'updateCartBadge', 
                count: totalItems 
            }, "*");
        // Load footer
        document.getElementById("footer-frame").src = "../template/footer.html";
    });

    // ========== MESSAGE HANDLING FROM HEADER ==========
    window.addEventListener("message", (e) => {
        if (!e.data || !e.data.action) return;

        if (e.data.action === "goToLogin") {
            window.location.href = "00_LOGIN.html";
        }

        if (e.data.action === "goToSignup") {
            window.location.href = "00_SIGNUP.html";
        }

        if (e.data.action === "loginSuccess" || e.data.action === "loggedIn") {
            localStorage.setItem("isLoggedIn", "true");
            document.getElementById("header-frame").src = "../template/header.html";
        }

        if (e.data.action === "logout") {
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("login_infor");
            document.getElementById("header-frame").src = "../template/header0.html";
        }

        if (e.data.action === "search") {
            const query = e.data.query?.trim();
            if (query) {
                window.location.href = `../pages/03_PRODUCT_SearchFilter.html?q=${encodeURIComponent(query)}`;
            }
        }

        if (e.data.action === "toggleNotifications") {
            if (!window.NotificationPopup) {
                window.NotificationPopup = createNotificationPopupInParent(
                    e.data.notifications, 
                    e.data.bellPosition
                );
            } else {
                window.NotificationPopup.toggle();
            }
        }
    });
</script>
</body>
</html>