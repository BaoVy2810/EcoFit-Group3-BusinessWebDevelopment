<html>
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <link rel="icon" href="../images/ecofit_logo2.png" sizes="32x32" type="image/png">
    <link rel="stylesheet" href="../css/USER_MAINSTYLE.css">   
    <script src="../js/notification_handler.js"></script> 
</head>
<body>
    <iframe id="header-frame" class="header-frame"></iframe>
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const header = document.getElementById("header-frame");
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
            header.src = isLoggedIn 
                ? "../template/header.html" 
                : "../template/header0.html";

            header.onload = () => {
                header.contentWindow.postMessage({ activeNav: "nav-shop" }, "*");
            };
        });

        window.addEventListener("message", (e) => {
            if (!e.data || !e.data.action) return;

            if (e.data.action === "goToLogin") {
                window.location.href = "00_LOGIN.html";
            }

            if (e.data.action === "goToSignup") {
                window.location.href = "00_SIGNUP.html";
            }

            if (e.data.action === "loginSuccess" || e.data.action === "loggedIn") {
                localStorage.setItem("isLoggedIn", "true");
                document.getElementById("header-frame").src = "../template/header.html";
            }

            if (e.data.action === "logout") {
                localStorage.removeItem("isLoggedIn");
                localStorage.removeItem("login_infor");
                document.getElementById("header-frame").src = "../template/header0.html";
            }

            if (e.data.action === "toggleNotifications") {
                if (!window.NotificationPopup) {
                    window.NotificationPopup = createNotificationPopupInParent(
                        e.data.notifications, 
                        e.data.bellPosition
                    );
                } else {
                    window.NotificationPopup.toggle();
                }
            }
        });
        
        document.addEventListener("click", e => {
            if (e.target.type === "radio") {
                if (e.target.wasChecked) {
                    e.target.checked = false;
                }
                e.target.wasChecked = e.target.checked;
            }
        });
    </script>
    
    <div class="checkout-container">
        <!-- LEFT -->
        <div class="checkout-left">
            <h2 class="checkout-left__title">DELIVERY INFORMATION</h2>
            
            <div class="form-group floating-label">
                <input type="text" id="fullname" required placeholder=" ">
                <label for="fullname">Full Name</label>
            </div>

            <div class="form-group floating-label">
                <input type="tel" id="phone" required placeholder=" ">
                <label for="phone">Phone Number</label>
            </div>

            <div class="form-group floating-label">
                <input type="text" id="address" required placeholder=" ">
                <label for="address">Address (District/Province/City)</label>
            </div>


            <hr/>
            
            <h2 class="checkout-left__title">DELIVERY METHOD</h2>
            <div class="option-box">
                <label class="custom-radio">
                    <input type="radio" name="delivery" checked/>
                    <span class="radio-mark"></span>
                    Home delivery
                </label>
                <span>30.000đ</span>
            </div>
            
            <hr/>
            
            <h2 class="checkout-left__title">PAYMENT METHOD</h2>
            <div class="option-box">
                <label class="custom-radio">
                    <input type="radio" name="payment"/>
                    <span class="radio-mark"></span>
                    Transfer via QR code 
                    <img src="../images/qr.png" width="20px" style="vertical-align: bottom;" />
                </label>
            </div>
            <div class="option-box">
                <label class="custom-radio">
                    <input type="radio" name="payment"/>
                    <span class="radio-mark"></span>
                    Transfer via Momo 
                    <img src="../images/momo.svg" width="20px" style="vertical-align: bottom;" />
                </label>
            </div>
        </div>
        
        <!-- RIGHT -->
        <div class="checkout-right">
            <!-- ORDER DETAIL -->
            <div class="order-detail">
                <h3 class="order-detail__title">ORDER DETAIL</h3>
                <!-- Sản phẩm sẽ được load động từ JavaScript -->
            </div>
            
            <br/>
            
            <!-- ORDER SUMMARY -->
            <div class="order-summary">
                <h2 class="order-summary__title">ORDER SUMMARY</h2>
                
                <div class="order-summary__row">
                    <span>Subtotal Product</span>
                    <span class="order-summary__value subtotal">-</span>
                </div>
                
                <div class="order-summary__row">
                    <span>Shipping Cost</span>
                    <span class="order-summary__value shipping">30.000đ</span>
                </div>
                
                <div class="order-summary__row">
                    <span>Discount</span>
                    <span class="order-summary__value discount">-</span>
                </div>
                
                <div class="order-summary__discount">
                    <input type="text" placeholder="Enter your discount code" class="discount-input">
                    <button class="apply-btn">APPLY</button>
                </div>
                
                <div class="order-summary__total">
                    <span>Total</span>
                    <span class="total-value">-</span>
                </div>
                
                <button class="place-order">
                    <a href="07_PAYMENT1.html" target="_self">PLACE ORDER →</a>
                </button>
            </div>
        </div>
    </div>
    
    <iframe src="../template/footer.html" id="footer-frame" class="footer-frame"></iframe>
    <script src="../js/checkout.js"></script>
</body>
</html>